{"version":3,"file":"module-types.min.js","sources":["../../src/err-msg.js","../../src/extras/module-types.js"],"sourcesContent":["export function errMsg(errCode, msg) {\n  if (process.env.SYSTEM_PRODUCTION)\n    return (msg || \"\") + \" (SystemJS https://git.io/JvFET#\" + errCode + \")\";\n  else\n    return (msg || \"\") + \" (SystemJS Error#\" + errCode + \" \" + \"https://git.io/JvFET#\" + errCode + \")\";\n}","import { errMsg } from '../err-msg.js';\n\n/*\n * Loads JSON, CSS, Wasm module types based on file extensions\n * Supports application/javascript falling back to JS eval\n */\n(function(global) {\n  var systemJSPrototype = global.System.constructor.prototype;\n  var instantiate = systemJSPrototype.instantiate;\n\n  var moduleTypesRegEx = /\\.(css|html|json|wasm)$/;\n  systemJSPrototype.shouldFetch = function (url) {\n    var path = url.split('?')[0].split('#')[0];\n    var ext = path.slice(path.lastIndexOf('.'));\n    return ext.match(moduleTypesRegEx);\n  }\n  systemJSPrototype.fetch = function (url) {\n    return fetch(url);\n  };\n\n  systemJSPrototype.instantiate = function (url, parent) {\n    var loader = this;\n    if (this.shouldFetch(url)) {\n      return this.fetch(url)\n      .then(function (res) {\n        if (!res.ok)\n          throw Error(errMsg(7, process.env.SYSTEM_PRODUCTION ? [res.status, res.statusText, url, parent].join(', ') : res.status + ' ' + res.statusText + ', loading ' + url + (parent ? ' from ' + parent : '')));\n        var contentType = res.headers.get('content-type');\n        if (!contentType)\n          throw Error(errMsg(4, process.env.SYSTEM_PRODUCTION ? [url, parent] : 'Missing header \"Content-Type\", loading ' + url + (parent ? ' from ' + parent : '')));\n        if (contentType.match(/^(text|application)\\/(x-)?javascript(;|$)/)) {\n          return res.text().then(function (source) {\n            (0, eval)(source);\n            return loader.getRegister();\n          });\n        }\n        else if (contentType.match(/^application\\/json(;|$)/)) {\n          return res.text().then(function (source) {\n            return [[], function (_export) {\n              return {\n                execute: function () {\n                  _export('default', JSON.parse(source));\n                }\n              };\n            }];\n          });\n        }\n        else if (contentType.match(/^text\\/css(;|$)/)) {\n          return res.text().then(function (source) {\n            return [[], function (_export) {\n              return {\n                execute: function () {\n                  // Relies on a Constructable Stylesheet polyfill\n                  var stylesheet = new CSSStyleSheet();\n                  stylesheet.replaceSync(source);\n                  _export('default', stylesheet);\n                }\n              };\n            }];\n          }); \n        }\n        else if (contentType.match(/^application\\/wasm(;|$)/)) {\n          return (WebAssembly.compileStreaming ? WebAssembly.compileStreaming(res) : res.arrayBuffer().then(WebAssembly.compile))\n          .then(function (module) {\n            var deps = [];\n            var setters = [];\n            var importObj = {};\n        \n            // we can only set imports if supported (eg early Safari doesnt support)\n            if (WebAssembly.Module.imports)\n              WebAssembly.Module.imports(module).forEach(function (impt) {\n                var key = impt.module;\n                if (deps.indexOf(key) === -1) {\n                  deps.push(key);\n                  setters.push(function (m) {\n                    importObj[key] = m;\n                  });\n                }\n              });\n        \n            return [deps, function (_export) {\n              return {\n                setters: setters,\n                execute: function () {\n                  return WebAssembly.instantiate(module, importObj)\n                  .then(function (instance) {\n                    _export(instance.exports);\n                  });\n                }\n              };\n            }];\n          });\n        }\n        else {\n          throw Error(errMsg(4, process.env.SYSTEM_PRODUCTION ? contentType : 'Unknown module type \"' + contentType + '\"'));\n        }\n      });\n    }\n    return instantiate.apply(this, arguments);\n  };\n})(typeof self !== 'undefined' ? self : global);\n"],"names":["errMsg","errCode","msg","global","systemJSPrototype","System","constructor","prototype","instantiate","shouldFetch","url","path","split","slice","lastIndexOf","match","fetch","parent","loader","this","then","res","ok","Error","status","statusText","join","contentType","headers","get","text","source","eval","getRegister","_export","execute","JSON","parse","stylesheet","CSSStyleSheet","replaceSync","WebAssembly","compileStreaming","arrayBuffer","compile","module","deps","setters","importObj","Module","imports","forEach","impt","key","indexOf","push","m","instance","exports","apply","arguments","self"],"mappings":"YAAO,SAASA,EAAOC,EAASC,GAE5B,OAAQA,GAAO,IAAM,mCAAqCD,EAAU,KCIxE,SAAUE,GACR,IAAIC,EAAoBD,EAAOE,OAAOC,YAAYC,UAC9CC,EAAcJ,EAAkBI,YAGpCJ,EAAkBK,YAAc,SAAUC,GACxC,IAAIC,EAAOD,EAAIE,MAAM,KAAK,GAAGA,MAAM,KAAK,GAExC,OADUD,EAAKE,MAAMF,EAAKG,YAAY,MAC3BC,MAJU,4BAMvBX,EAAkBY,MAAQ,SAAUN,GAClC,OAAOM,MAAMN,IAGfN,EAAkBI,YAAc,SAAUE,EAAKO,GAC7C,IAAIC,EAASC,KACb,OAAIA,KAAKV,YAAYC,GACZS,KAAKH,MAAMN,GACjBU,MAAK,SAAUC,GACd,IAAKA,EAAIC,GACP,MAAMC,MAAMvB,EAAO,EAAmC,CAACqB,EAAIG,OAAQH,EAAII,WAAYf,EAAKO,GAAQS,KAAK,QACvG,IAAIC,EAAcN,EAAIO,QAAQC,IAAI,gBAClC,IAAKF,EACH,MAAMJ,MAAMvB,EAAO,EAAmC,CAACU,EAAKO,KAC9D,GAAIU,EAAYZ,MAAM,6CACpB,OAAOM,EAAIS,OAAOV,MAAK,SAAUW,GAE/B,OADA,EAAIC,MAAMD,GACHb,EAAOe,iBAGb,GAAIN,EAAYZ,MAAM,2BACzB,OAAOM,EAAIS,OAAOV,MAAK,SAAUW,GAC/B,MAAO,CAAC,GAAI,SAAUG,GACpB,MAAO,CACLC,QAAS,WACPD,EAAQ,UAAWE,KAAKC,MAAMN,WAMnC,GAAIJ,EAAYZ,MAAM,mBACzB,OAAOM,EAAIS,OAAOV,MAAK,SAAUW,GAC/B,MAAO,CAAC,GAAI,SAAUG,GACpB,MAAO,CACLC,QAAS,WAEP,IAAIG,EAAa,IAAIC,cACrBD,EAAWE,YAAYT,GACvBG,EAAQ,UAAWI,UAMxB,GAAIX,EAAYZ,MAAM,2BACzB,OAAQ0B,YAAYC,iBAAmBD,YAAYC,iBAAiBrB,GAAOA,EAAIsB,cAAcvB,KAAKqB,YAAYG,UAC7GxB,MAAK,SAAUyB,GACd,IAAIC,EAAO,GACPC,EAAU,GACVC,EAAY,GAchB,OAXIP,YAAYQ,OAAOC,SACrBT,YAAYQ,OAAOC,QAAQL,GAAQM,SAAQ,SAAUC,GACnD,IAAIC,EAAMD,EAAKP,QACY,IAAvBC,EAAKQ,QAAQD,KACfP,EAAKS,KAAKF,GACVN,EAAQQ,MAAK,SAAUC,GACrBR,EAAUK,GAAOG,SAKlB,CAACV,EAAM,SAAUZ,GACtB,MAAO,CACLa,QAASA,EACTZ,QAAS,WACP,OAAOM,YAAYjC,YAAYqC,EAAQG,GACtC5B,MAAK,SAAUqC,GACdvB,EAAQuB,EAASC,mBAQ3B,MAAMnC,MAAMvB,EAAO,EAAmC2B,OAIrDnB,EAAYmD,MAAMxC,KAAMyC,YA5FnC,CA8FmB,oBAATC,KAAuBA,KAAO1D"}